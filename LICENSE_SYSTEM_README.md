# نظام حماية التطبيق - دليل المطور

## نظرة عامة

تم تطبيق نظام حماية متكامل للتطبيق باستخدام **Hardware Fingerprinting + License Key** لحماية التطبيق من النسخ غير المصرح به.

## المكونات الأساسية

### 1. خدمات النظام

#### `HardwareService`
- قراءة معلومات الجهاز وإنشاء بصمة فريدة
- دعم جميع المنصات (Windows, Android, iOS, macOS, Linux)
- تشفير البصمة لحماية إضافية

#### `LicenseService`
- إدارة مفاتيح الترخيص
- تشفير وحماية المفاتيح
- فحص صحة الترخيص
- ربط الترخيص ببصمة الجهاز

#### `LicenseProvider`
- إدارة حالة الترخيص عبر التطبيق
- توفير معلومات الترخيص للواجهات
- معالجة أحداث التفعيل وإلغاء التفعيل

### 2. الشاشات

#### `LicenseCheckScreen`
- شاشة فحص الترخيص الرئيسية
- عرض حالة الترخيص
- معلومات الجهاز والترخيص
- أزرار الإجراءات

#### `LicenseActivationScreen`
- شاشة إدخال مفتاح الترخيص
- نموذج التفعيل مع معلومات العميل
- عرض معلومات الجهاز

### 3. أدوات المطور

#### `LicenseGenerator`
- إنشاء مفاتيح ترخيص جديدة
- التحقق من صحة المفاتيح
- إنشاء دفعات من المفاتيح
- استخراج معلومات من المفاتيح

## كيفية الاستخدام

### للمطور (إنشاء مفاتيح الترخيص)

```dart
import 'lib/src/utils/license_generator.dart';

// إنشاء مفتاح ترخيص واحد
String license = LicenseGenerator.generateLicenseKey();
print('المفتاح: $license');

// إنشاء مفتاح مع معلومات العميل
String licenseWithCustomer = LicenseGenerator.generateLicenseKey(
  customerName: 'محل الكمبيوتر',
);

// إنشاء دفعة من المفاتيح
List<String> batch = LicenseGenerator.generateBatch(
  count: 10,
  customerPrefix: 'SHOP',
);

// التحقق من صحة مفتاح
bool isValid = LicenseGenerator.validateLicenseKey('OFFICE-2024-ABC123-XYZ789');
```

### للعميل (تفعيل التطبيق)

1. **تثبيت التطبيق**
2. **إدخال مفتاح الترخيص** في شاشة التفعيل
3. **التحقق التلقائي** من البصمة
4. **الاستخدام** بعد التفعيل الناجح

## تنسيق مفتاح الترخيص

```
OFFICE-YYYY-XXXXXX-XXXXXXXX
```

- **OFFICE**: بادئة ثابتة
- **YYYY**: السنة (مثال: 2024)
- **XXXXXX**: نص عشوائي (6 أحرف)
- **XXXXXXXX**: نص عشوائي (8 أحرف)

### مثال:
```
OFFICE-2024-ABC123-XYZ789
```

## آلية الحماية

### 1. البصمة الفريدة
- قراءة معلومات الجهاز (MAC Address, Serial Number, إلخ)
- إنشاء بصمة مشفرة فريدة
- ربط البصمة بمفتاح الترخيص

### 2. التشفير
- تشفير مفتاح الترخيص باستخدام AES
- حماية المفاتيح في التخزين المحلي
- فحص التلاعب في الملفات

### 3. فحص دوري
- فحص الترخيص عند بدء التطبيق
- التحقق من صحة البصمة
- منع الاستخدام على أجهزة أخرى

## إدارة المفاتيح

### إنشاء قاعدة بيانات بسيطة

```csv
الرقم,المفتاح,اسم العميل,التاريخ,الحالة
1,OFFICE-2024-ABC123-XYZ789,محل الكمبيوتر,2024-01-15,مباع
2,OFFICE-2024-DEF456-UVW012,شركة التقنية,2024-01-16,مباع
```

### نظام البيع المقترح

1. **موقع ويب بسيط** لبيع المفاتيح
2. **نظام دفع آمن** (PayPal, Stripe)
3. **إرسال تلقائي** للمفاتيح
4. **دعم فني** للعملاء

## الأمان والحماية

### نقاط القوة
- ✅ **حماية قوية** ضد النسخ
- ✅ **ربط بجهاز محدد**
- ✅ **تشفير المفاتيح**
- ✅ **فحص دوري**

### نقاط الضعف المحتملة
- ⚠️ **تغيير مكونات الجهاز** قد يؤثر على البصمة
- ⚠️ **إعادة تثبيت النظام** قد يتطلب إعادة تفعيل
- ⚠️ **التلاعب المتقدم** قد يحتاج حماية إضافية

## التحديثات المستقبلية

### تحسينات مقترحة
1. **خادم ترخيص** للتحكم المركزي
2. **تحديثات الترخيص** عن بُعد
3. **إحصائيات الاستخدام**
4. **نظام الإشعارات**

### حماية إضافية
1. **Code Obfuscation**
2. **Anti-debugging**
3. **Runtime Protection**
4. **License Server Integration**

## استكشاف الأخطاء

### مشاكل شائعة

#### الترخيص لا يعمل على جهاز جديد
```
السبب: البصمة لا تطابق
الحل: إعادة تفعيل بمفتاح جديد
```

#### خطأ في قراءة معلومات الجهاز
```
السبب: صلاحيات النظام
الحل: تشغيل بصلاحيات المدير
```

#### مفتاح الترخيص غير صحيح
```
السبب: خطأ في الإدخال أو المفتاح
الحل: التحقق من التنسيق
```

## الدعم الفني

### معلومات مطلوبة من العميل
1. **مفتاح الترخيص**
2. **معلومات الجهاز** (من التطبيق)
3. **نوع الخطأ**
4. **لقطة شاشة** للرسالة

### حلول سريعة
1. **إعادة تفعيل** بمفتاح صحيح
2. **إعادة تثبيت** التطبيق
3. **تشغيل بصلاحيات المدير**
4. **الاتصال بالدعم الفني**

## الخلاصة

نظام الحماية المطبق يوفر:
- 🔒 **حماية قوية** ضد النسخ غير المصرح
- 💰 **دخل مستقر** من بيع التراخيص
- 🛠️ **سهولة الإدارة** والتحكم
- 📱 **دعم متعدد المنصات**

النظام جاهز للاستخدام ويمكن توسيعه حسب الحاجة.
